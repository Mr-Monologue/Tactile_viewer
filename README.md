# GLB 触觉演示

本项目是一个基于 Three.js 的网页工具，用于加载 GLB/GLTF 模型，并在指定区域内生成可视化的六角网格“触觉点云”。这些点通过自定义 Shader 以圆盘的形式渲染，配合动态标量场演示，可用于触觉贴片、传感阵列等场景的快速验证与展示。

## 主要特性

- **GLB/GLTF 加载**：支持本地文件加载，内置 Draco 与 Meshopt 解码。
- **可视化触觉点云**：对模型或 `touch_area` 子网格执行六角网格采样，自动适配模型尺度。
- **高鲁棒采样**：利用面积加权法向、扇形多方向射线与 BVH，稳定覆盖曲面外侧区域。
- **动态演示**：内置虚拟波动标量场（颜色 + 强度），模拟触觉信号动画效果。
- **UI 控件**：提供重新采样、视角重置、自动旋转、背景切换等常用操作。

## 快速开始

1. **准备环境**：只需现代浏览器（建议 Chrome 114+ 或 Edge 114+）。
2. **打开页面**：双击 `glb_viewer_tactile.html` 或通过本地服务器访问。
3. **加载模型**：点击“选择 GLB”按钮，导入 `.glb`/`.gltf` 文件。
4. **观察结果**：模型载入后会自动采样，底部 HUD 显示采样点数与三角形数量。
5. **重新采样**：点击“重新采样”按钮可重新生成点云（可配合调整常量 `DEFAULT_HEX_SPACING`）。

## 控件与交互

- **鼠标操作**（OrbitControls）：
  - 左键旋转、滚轮缩放、中键平移。
- **界面按钮**：
  - `重新采样`：重新触发六角铺点；默认步距由 `DEFAULT_HEX_SPACING` 控制。
  - `重置视角`：相机回到模型自适应视角。
  - `自动旋转`：切换相机漫游。
  - `暗色背景`：切换暗色/亮色背景及地网显示。
- **HUD 信息**：实时显示当前状态、有效点数与模型三角面数。

## 六角采样流程

1. **合并几何**：优先使用 `touch_area` 子网格；若不存在则对整模型采样。
2. **法向基构建**：使用面积加权法向得到 `N`，再构造正交切向 `U/V`。
3. **UV 包围盒**：在局部平面计算六角网格大小并自适应缩放到实例上限。
4. **扇形射线**：从外侧起点沿多方向（0°/±12°/±24°/±45°）投射，选择最贴近外侧的命中。
5. **轴向兜底**：若扇形未命中，再做双向轴向探测以确认轮廓，再次尝试扇形。
6. **实例写回**：将命中点及法向写入 InstancedMesh，并根据尺度设置抬离量与圆盘半径。

## 配置与扩展

- 默认步距常量：`DEFAULT_HEX_SPACING = 0.003`（需根据模型单位调整）。
- 采样参数：可在 `TactileLayer.resampleHexGrid()` 中调整扇形角度、抬离倍数等。
- 点云着色：`updateDemoScalar()` 控制颜色与强度动画，按需替换为真实数据。
- 若模型未命中，可在代码中启用 `closestPoint` 兜底策略（目前默认关闭）。

## 常见问题

- **点云过少/缺口**：尝试减小 `DEFAULT_HEX_SPACING` 或增大扇形角度、射线范围。
- **点被遮挡**：可暂时将 `matDisks.depthTest = false` 验证是否为深度遮挡问题。
- **模型内侧被采样**：确保 `touch_area` 法向一致，必要时在导入前统一法线方向。

## 开发说明

- 使用 ES Modules 与 CDN 依赖，便于纯静态部署。
- 关键依赖：
  - `three@0.160.0`
  - `three/examples` 下的控制器与加载器
  - `three-mesh-bvh`（用于 BVH 加速与最近点查询）
- 推荐结合本 README 与源码，按需扩展自定义 UI 或导出功能。

欢迎根据自身项目需求继续完善。若在使用中遇到问题，可先检查浏览器控制台日志，快速定位加载或采样阶段的异常。
